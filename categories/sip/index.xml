<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:content="http://purl.org/rss/1.0/modules/content/">
  <channel>
    <title>sip on Gavin Henry&#39;s Blog</title>
    <link>https://ghenry.co.uk/categories/sip/</link>
    <description>Recent content in sip on Gavin Henry&#39;s Blog</description>
    <image>
      <url>https://pbs.twimg.com/profile_images/1566092118086516736/CAbU48Qt_400x400.jpg</url>
      <link>https://pbs.twimg.com/profile_images/1566092118086516736/CAbU48Qt_400x400.jpg</link>
    </image>
    <generator>Hugo -- gohugo.io</generator>
    <lastBuildDate>Mon, 03 Oct 2022 21:10:03 +0000</lastBuildDate><atom:link href="https://ghenry.co.uk/categories/sip/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>Protect your SIP Servers from bad actors</title>
      <link>https://ghenry.co.uk/posts/sentrypeer/</link>
      <pubDate>Mon, 03 Oct 2022 21:10:03 +0000</pubDate>
      
      <guid>https://ghenry.co.uk/posts/sentrypeer/</guid>
      <description>Learn about SentryPeer</description>
      <content:encoded><![CDATA[<h2 id="protect-your-sip-servers-from-bad-actors">Protect your SIP Servers from bad actors</h2>
<h3 id="introduction">Introduction</h3>
<p>SentryPeer<!-- raw HTML omitted -->Â®<!-- raw HTML omitted --> is a fraud detection tool. It lets bad actors try to make phone calls and saves the IP address they came from and
number they tried to call. Those details can then be used to raise notifications at the service providers network and the next
time a user/customer tries to call a collected number, you can act anyway you see fit.</p>
<p>For example:</p>
<p>Let&rsquo;s say you are running your own VoIP PBX on site. What SentryPeer will allow you to do in this context,
is dip into the list of phone numbers (using the RESTful API) when your users are making outbound calls. If you get a hit,
you&rsquo;ll get a heads-up that potentially a device within your network is trying to call known probing phone numbers that
have either been:</p>
<ol>
<li>Numbers collected by SentryPeer nodes you are running yourself</li>
<li>Numbers seen by other SentryPeer nodes which have been replicated to your node via the peer to peer network</li>
</ol>
<p>This would allow you to generate a notification from your monitoring systems before you rack
up any expensive calls or something worse happens.</p>
<p>What would lead to this scenario?</p>
<ol>
<li>Potential voicemail fraud. This can happen if you allow calling an
inbound number (your DID/DDI) to get to your voicemail system, then
prompt for a PIN. This PIN is weak and the voicemail system allows you
to press &lsquo;*&rsquo; to call back the Caller ID that left a voicemail. The
attacker has left a voicemail, and they then guess your PIN and call it
back. The CLI is a known number that SentryPeer has seen. You can alert on it.</li>
<li>A device has been hijacked and/or a softphone or similar is using
the credentials they stole off the phone&rsquo;s GUI and is trying to
register to your system and make calls to a number seen by SentryPeer.</li>
<li>An innocent user is calling a phishing number or known expensive
number etc. that SentryPeer has seen before.</li>
</ol>
<p>Traditionally this data is shipped to a central place, so you don&rsquo;t own the data you&rsquo;ve collected. This project is all about Peer to Peer sharing of that data. The user owning the data and various Service Provider / Network Provider related feeds of the data is the key bit for me. I&rsquo;m sick of all the services out there that keep it and sell it. If you&rsquo;ve collected it, you should have the choice to keep it and/or opt in to share it with other SentryPeer community members via p2p methods.</p>
<h3 id="features">Features</h3>
<ul>
<li><input checked="" disabled="" type="checkbox"> All code <a href="https://www.gnu.org/philosophy/floss-and-foss.en.html">Free/Libre and Open Source Software</a></li>
<li><input checked="" disabled="" type="checkbox"> FAST</li>
<li><input checked="" disabled="" type="checkbox"> User <em>owns their</em> data</li>
<li><input checked="" disabled="" type="checkbox"> User can submit their own data if they want to (you need to enable p2p mode - <code>-p</code>)</li>
<li><input checked="" disabled="" type="checkbox"> User gets other users&rsquo; data <strong>ONLY IF</strong> they opt in to submit their data to the pool</li>
<li><input checked="" disabled="" type="checkbox"> Embedded Distributed Hash Table (DHT) node using <a href="https://github.com/savoirfairelinux/opendht/wiki/Running-a-node-in-your-program">OpenDHT</a> (<code>-p</code> cli option)</li>
<li><input checked="" disabled="" type="checkbox"> Peer to Peer <strong>sharing</strong> of collected bad_actors using <a href="https://github.com/savoirfairelinux/opendht">OpenDHT</a> (default on)</li>
<li><input checked="" disabled="" type="checkbox"> Peer to Peer data replication to <strong>receive</strong> collected bad_actors using <a href="https://github.com/savoirfairelinux/opendht">OpenDHT</a> (default on)</li>
<li><input checked="" disabled="" type="checkbox"> Set your own DHT bootstrap node (<code>-b</code> cli option)</li>
<li><input checked="" disabled="" type="checkbox"> Multithreaded</li>
<li><input checked="" disabled="" type="checkbox"> UDP transport</li>
<li><input checked="" disabled="" type="checkbox"> TCP transport</li>
<li><input disabled="" type="checkbox"> TLS transport</li>
<li><input checked="" disabled="" type="checkbox"> <a href="#json-log-format">JSON logging</a> to a file</li>
<li><input checked="" disabled="" type="checkbox"> SIP mode can be disabled. This allows you to run SentryPeer in API mode or DHT mode only etc. i.e.
not as a honeypot, but as a node in the SentryPeer community or to just serve replicated data</li>
<li><input checked="" disabled="" type="checkbox"> SIP responsive mode can be enabled to collect data - cli / env flag</li>
<li><input checked="" disabled="" type="checkbox"> <strong>Local</strong> data copy for <strong>fast access</strong> - cli / env db location flag</li>
<li><input checked="" disabled="" type="checkbox"> <strong>Local</strong> API for <strong>fast access</strong> - cli / env flag</li>
<li><input checked="" disabled="" type="checkbox"> WebHook for POSTing bad actor json to a central location - cli / env flag</li>
<li><input checked="" disabled="" type="checkbox"> Query API for IP addresses of bad actors</li>
<li><input disabled="" type="checkbox"> Query API for IPSET of bad actors</li>
<li><input checked="" disabled="" type="checkbox"> Query API for a particular IP address of a bad actor</li>
<li><input checked="" disabled="" type="checkbox"> Query API for attempted phone numbers called by bad actors</li>
<li><input checked="" disabled="" type="checkbox"> Query API for an attempted phone number called by a bad actor</li>
<li><input checked="" disabled="" type="checkbox"> <a href="https://www.fail2ban.org/wiki/index.php/Main_Page">Fail2Ban</a> support via <code>syslog</code> as per <a href="https://github.com/SentryPeer/SentryPeer/issues/6">feature request</a></li>
<li><input checked="" disabled="" type="checkbox"> Local <a href="https://www.sqlite.org/index.html">sqlite</a> database - feature / cli flag</li>
<li><input disabled="" type="checkbox"> Analytics - opt in</li>
<li><input disabled="" type="checkbox"> SDKs/libs for external access - <a href="https://github.com/cgrates/cgrates">CGRateS</a> to start with or our own firewall with nftables</li>
<li><input checked="" disabled="" type="checkbox"> Small binary size for IoT usage</li>
<li><input checked="" disabled="" type="checkbox"> Cross-platform</li>
<li><input disabled="" type="checkbox"> Firewall options to use distributed data in real time - <a href="https://en.wikipedia.org/wiki/Distributed_hash_table">DHT</a>?</li>
<li><input checked="" disabled="" type="checkbox"> Container on <a href="https://hub.docker.com/r/sentrypeer/sentrypeer">Docker Hub for latest build</a></li>
<li><input disabled="" type="checkbox"> BGP agent to peer with for blackholing collected IP addresses (similar to <a href="https://team-cymru.com/community-services/bogon-reference/bogon-reference-bgp/">Team Cymru Bogon Router Server Project</a>)</li>
<li><input disabled="" type="checkbox"> SIP agent to return 404 or default destination for SIP redirects</li>
</ul>
<h3 id="talks">Talks</h3>
<ul>
<li>TADSummit 2021 - <a href="https://blog.tadsummit.com/2021/11/17/sentrypeer/">https://blog.tadsummit.com/2021/11/17/sentrypeer/</a></li>
<li>CommCon 2021 - <a href="https://2021.commcon.xyz/talks/sentrypeer-a-distributed-peer-to-peer-list-of-bad-ip-addresses-and-phone-numbers-collected-via-a-sip-honeypot">https://2021.commcon.xyz/talks/sentrypeer-a-distributed-peer-to-peer-list-of-bad-ip-addresses-and-phone-numbers-collected-via-a-sip-honeypot</a></li>
<li>ClueCon Weekly 2022 - <a href="https://youtu.be/DFxGHJI_0Wg">https://youtu.be/DFxGHJI_0Wg</a></li>
<li>UKNOF49 2022 (<a href="https://indico.uknof.org.uk/event/59/contributions/801/attachments/1033/1520/UKNOF-49-2022-SentryPeer.pdf">presentation slides</a>) - <a href="https://indico.uknof.org.uk/event/59/contributions/801/">https://indico.uknof.org.uk/event/59/contributions/801/</a></li>
</ul>
<h3 id="adoption">Adoption</h3>
<ul>
<li><a href="https://pkg.kali.org/pkg/sentrypeer">Kali Linux</a></li>
<li>Deutsche Telekom <a href="https://github.com/telekom-security/tpotce">T-Pot - The All In One Honeypot Platform</a> <a href="https://github.com/telekom-security/tpotce/releases/tag/22.04.0">v22</a> onwards</li>
</ul>
<p><img loading="lazy" src="https://img.shields.io/matrix/sentrypeer:matrix.org?label=matrix&amp;logo=matrix" alt="Matrix"  />

<a href="https://join.slack.com/t/sentrypeer/shared_invite/zt-zxsmfdo7-iE0odNT2XyKLP9pt0lgbcw"><img loading="lazy" src="https://img.shields.io/badge/join-us%20on%20slack-gray.svg?longCache=true&amp;logo=slack&amp;colorB=brightgreen" alt="slack"  />
</a>
<a href="https://twitter.com/SentryPeer"><img loading="lazy" src="https://img.shields.io/badge/follow-twitter-blue" alt="SentryPeer on Twitter"  />
</a></p>
<h3 id="design">Design</h3>
<p>I started this because I wanted to do <a href="https://github.com/codeplea/Hands-On-Network-Programming-with-C">C network programming</a> as all the projects I use daily are in C like <a href="https://www.postgresql.org/">PostgreSQL</a>, <a href="https://www.openldap.org/">OpenLDAP</a>, <a href="https://freeswitch.com/">FreeSWITCH</a>, <a href="https://opensips.org/">OpenSIPS</a>,
<a href="https://www.asterisk.org/">Asterisk</a> etc. See
<a href="https://www.se-radio.net/2020/06/episode-414-jens-gustedt-on-modern-c/">Episode 414: Jens Gustedt on Modern C</a> for why <a href="https://en.wikipedia.org/wiki/C_(programming_language)">C</a> is a good choice.  For those interested, see my full podcast show list (<a href="https://www.se-radio.net/team/gavin-henry/">https://www.se-radio.net/team/gavin-henry/</a>) for <a href="https://www.se-radio.net/">Software Engineering Radio</a></p>
<h3 id="docker">Docker</h3>
<p>You can run the latest version of SentryPeer with <a href="https://www.docker.com/">Docker</a>. The latest version is available from <a href="https://hub.docker.com/r/sentrypeer/sentrypeer/">Docker Hub</a>.
Or build yourself:</p>
<pre><code>sudo docker build --no-cache -t sentrypeer .
sudo docker run -d -p 5050:5060/tcp -p 5060:5060/udp -p 8082:8082 -p 4222:4222/udp sentrypeer:latest
</code></pre>
<p>Then you can check at <code>http://localhost:8082/ip-addresses</code> and <code>http://localhost:8082/health-check</code> to see if it&rsquo;s running.</p>
<h4 id="environment-variables">Environment Variables</h4>
<pre><code>ENV SENTRYPEER_DB_FILE=/my/location/sentrypeer.db
ENV SENTRYPEER_API=1
ENV SENTRYPEER_WEBHOOK_URL=https://my.webhook.url/events
ENV SENTRYPEER_SIP_RESPONSIVE=1
ENV SENTRYPEER_SIP_DISABLE=1
ENV SENTRYPEER_SYSLOG=1
ENV SENTRYPEER_PEER_TO_PEER=1
ENV SENTRYPEER_BOOTSTRAP_NODE=mybootstrapnode.com
ENV SENTRYPEER_JSON_LOG=1
ENV SENTRYPEER_JSON_LOG_FILE=/my/location/sentrypeer_json.log
ENV SENTRYPEER_VERBOSE=1
ENV SENTRYPEER_DEBUG=1
</code></pre>
<p>Either set these in the Dockerfile or in your <code>Dockerfile.env</code> file or docker run command.</p>
<h3 id="installation">Installation</h3>
<p>Debian or Fedora packages are always available from the release page for the current version of SentryPeer:</p>
<p><a href="https://github.com/SentryPeer/SentryPeer/releases">https://github.com/SentryPeer/SentryPeer/releases</a></p>
<h4 id="homebrew-macos-or-linux">Homebrew (macOS or Linux):</h4>
<p>We have a <a href="https://github.com/SentryPeer/homebrew-sentrypeer">Homebrew Tap for this project</a> (until we get more popular):</p>
<pre><code>brew tap sentrypeer/sentrypeer
brew install sentrypeer
</code></pre>
<h4 id="alpine-linux">Alpine Linux:</h4>
<p>SentryPeer is in <a href="https://gitlab.alpinelinux.org/alpine/aports/-/tree/master/testing/sentrypeer">testing on Alpine Linux</a>, so you can install it with the following command:</p>
<pre><code>apk -U add --no-cache -X https://dl-cdn.alpinelinux.org/alpine/edge/testing sentrypeer
</code></pre>
<h4 id="ubuntu-package">Ubuntu Package</h4>
<p>You can install SentryPeer from <a href="https://launchpad.net/~gavinhenry/+archive/ubuntu/sentrypeer">our Ubuntu PPD</a> which
is currently for Ubuntu 20 LTS (Focal Fossa):</p>
<pre><code>sudo apt install software-properties-common
sudo add-apt-repository ppa:gavinhenry/sentrypeer
sudo apt-get update
</code></pre>
<p>This PPA can be added to your system manually by copying the lines below and adding them to your system&rsquo;s software
sources:</p>
<pre><code>deb https://ppa.launchpadcontent.net/gavinhenry/sentrypeer/ubuntu focal main 
deb-src https://ppa.launchpadcontent.net/gavinhenry/sentrypeer/ubuntu focal main
</code></pre>
<p>Then you can install SentryPeer:</p>
<pre><code>sudo apt-get install sentrypeer
</code></pre>
<h4 id="building-from-source">Building from source</h4>
<p>You have two options for installation from source. CMake or autotools. Autotools is recommended at the moment. A release is an autotools build.</p>
<p>If you are a Fedora user, you can install this via <a href="https://copr.fedorainfracloud.org/coprs/">Fedora copr</a>:</p>
<p><a href="https://copr.fedorainfracloud.org/coprs/ghenry/SentryPeer/">https://copr.fedorainfracloud.org/coprs/ghenry/SentryPeer/</a></p>
<p>If you are going to build from this repository, you will need to have the following installed:</p>
<ul>
<li><code>git</code>, <code>autoconf</code>, <code>automake</code> and <code>autoconf-archive</code> (Debian/Ubuntu)</li>
<li><code>libosip2-dev</code> (Debian/Ubuntu) or <code>libosip2-devel</code> (Fedora)</li>
<li><code>libsqlite3-dev</code> (Debian/Ubuntu) or <code>sqlite-devel</code> (Fedora)</li>
<li><code>uuid-dev</code> (Debian/Ubuntu) or <code>libuuid-devel</code> (Fedora)</li>
<li><code>libmicrohttpd-dev</code> (Debian/Ubuntu) or <code>libmicrohttpd-devel</code> (Fedora)</li>
<li><code>libjansson-dev</code> (Debian/Ubuntu) or <code>jansson-devel</code> (Fedora)</li>
<li><code>libpcre2-dev</code> (Debian/Ubuntu) or <code>pcre2-devel</code> (Fedora)</li>
<li><code>libcurl-dev</code> (Debian/Ubuntu) or <code>libcurl-devel</code> (Fedora)</li>
<li><code>libcmocka-dev</code> (Debian/Ubuntu) or <code>libcmocka-devel</code> (Fedora) - for unit tests</li>
</ul>
<p>Debian/Ubuntu:</p>
<pre><code>sudo apt-get install git build-essential autoconf-archive autoconf automake libosip2-dev libsqlite3-dev \
libcmocka-dev uuid-dev libcurl4-openssl-dev libpcre2-dev libjansson-dev libmicrohttpd-dev 
</code></pre>
<p>Fedora:</p>
<pre><code>sudo dnf install git autoconf automake autoconf-archive libosip2-devel libsqlite3-devel libcmocka-devel \
libuuid-devel libmicrohttpd-devel jansson-devel libcurl-devel pcre2-devel
</code></pre>
<p>macOS:</p>
<pre><code>brew install git autoconf automake autoconf-archive libosip cmocka libmicrohttpd jansson curl pcre2
</code></pre>
<p>then (make check is highly recommended):</p>
<pre><code>./bootstrap.sh
./configure
make
make check
make install
</code></pre>
<h3 id="running-sentrypeer">Running SentryPeer</h3>
<p>Once built, you can run like so to start in <strong>debug mode</strong>, <strong>respond</strong> to SIP probes, enable the <strong>RESTful API</strong>,
enable WebHooks and enable syslog logging (<a href="https://github.com/SentryPeer/SentryPeer/releases">use a package</a> if you want <a href="https://www.freedesktop.org/wiki/Software/systemd/">systemd</a>):</p>
<pre><code>./sentrypeer -draps
SentryPeer node id: e5ac3a88-3d52-4e84-b70c-b2ce83992d02
Starting sentrypeer...
API mode enabled, starting http daemon...
SIP mode enabled...
Peer to Peer DHT mode enabled...
Starting peer to peer DHT mode using OpenDHT-C lib version '2.4.0'...
Configuring local address...
Creating sockets...
Binding sockets to local address...
Listening for incoming UDP connections...
SIP responsive mode enabled. Will reply to SIP probes...
Listening for incoming TCP connections...
Peer to peer DHT mode started.
DHT InfoHash for key 'bad_actors' is: 14d30143330e2e0e922ed4028a60ff96a59800ad
Bootstrapping the DHT
Waiting 5 seconds for bootstrapping to bootstrap.sentrypeer.org...
Listening for changes to the bad_actors DHT key
</code></pre>
<p>when you get a probe request, you can see something like the following in the terminal:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">Received <span class="o">(</span><span class="m">411</span> bytes<span class="o">)</span>: OPTIONS sip:100@XXX.XXX.XXX.XXX SIP/2.0
</span></span><span class="line"><span class="cl">Via: SIP/2.0/UDP 91.223.3.152:5173<span class="p">;</span><span class="nv">branch</span><span class="o">=</span>z9hG4bK-515761064<span class="p">;</span>rport
</span></span><span class="line"><span class="cl">Content-Length: <span class="m">0</span>
</span></span><span class="line"><span class="cl">From: <span class="s2">&#34;sipvicious&#34;</span>&lt;sip:100@1.1.1.1&gt;<span class="p">;</span><span class="nv">tag</span><span class="o">=</span><span class="m">6434396633623535313363340131363131333837383137</span>
</span></span><span class="line"><span class="cl">Accept: application/sdp
</span></span><span class="line"><span class="cl">User-Agent: friendly-scanner
</span></span><span class="line"><span class="cl">To: <span class="s2">&#34;sipvicious&#34;</span>&lt;sip:100@1.1.1.1&gt;
</span></span><span class="line"><span class="cl">Contact: sip:100@91.223.3.152:5173
</span></span><span class="line"><span class="cl">CSeq: <span class="m">1</span> OPTIONS
</span></span><span class="line"><span class="cl">Call-ID: <span class="m">679894155883566215079442</span>
</span></span><span class="line"><span class="cl">Max-Forwards: <span class="m">70</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">read_packet_buf size is: 1024: 
</span></span><span class="line"><span class="cl">read_packet_buf length is: 468: 
</span></span><span class="line"><span class="cl">bytes_received size is: 411: 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Bad Actor is:
</span></span><span class="line"><span class="cl">Event Timestamp: 2021-11-23 20:13:36.427515810
</span></span><span class="line"><span class="cl">Event UUID: fac3fa20-8c2c-445b-8661-50a70fa9e873
</span></span><span class="line"><span class="cl">SIP Message: OPTIONS sip:100@XXX.XXX.XXX.XXX SIP/2.0
</span></span><span class="line"><span class="cl">Via: SIP/2.0/UDP 91.223.3.152:5173<span class="p">;</span><span class="nv">branch</span><span class="o">=</span>z9hG4bK-515761064<span class="p">;</span>rport
</span></span><span class="line"><span class="cl">From: <span class="s2">&#34;sipvicious&#34;</span> &lt;sip:100@1.1.1.1&gt;<span class="p">;</span><span class="nv">tag</span><span class="o">=</span><span class="m">6434396633623535313363340131363131333837383137</span>
</span></span><span class="line"><span class="cl">To: <span class="s2">&#34;sipvicious&#34;</span> &lt;sip:100@1.1.1.1&gt;
</span></span><span class="line"><span class="cl">Call-ID: <span class="m">679894155883566215079442</span>
</span></span><span class="line"><span class="cl">CSeq: <span class="m">1</span> OPTIONS
</span></span><span class="line"><span class="cl">Contact: &lt;sip:100@91.223.3.152:5173&gt;
</span></span><span class="line"><span class="cl">Accept: application/sdp
</span></span><span class="line"><span class="cl">User-agent: friendly-scanner
</span></span><span class="line"><span class="cl">Max-forwards: <span class="m">70</span>
</span></span><span class="line"><span class="cl">Content-Length: <span class="m">0</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Source IP: 193.107.216.27
</span></span><span class="line"><span class="cl">Called Number: <span class="m">100</span>
</span></span><span class="line"><span class="cl">SIP Method: OPTIONS
</span></span><span class="line"><span class="cl">Transport Type: UDP
</span></span><span class="line"><span class="cl">User Agent: friendly-scanner
</span></span><span class="line"><span class="cl">Collected Method: responsive
</span></span><span class="line"><span class="cl">Created by Node Id: fac3fa20-8c2c-445b-8661-50a70fa9e873
</span></span><span class="line"><span class="cl">SentryPeer db file location is: sentrypeer.db
</span></span><span class="line"><span class="cl">Destination IP address of UDP packet is: xx.xx.xx.xx
</span></span></code></pre></div><p>You can see the data in the sqlite3 database called <code>sentrypeer.db</code> using <a href="https://sqlitebrowser.org/">sqlitebrowser</a> or sqlite3 command line tool.</p>
<p>Here&rsquo;s a screenshot of the database opened using <a href="https://sqlitebrowser.org/">sqlitebrowser</a> (it&rsquo;s big, so I&rsquo;ll just link to the image):</p>
<p><a href="./screenshots/SentryPeer-sqlitebrowser.png">sqlitebrowser exploring the sentrypeer.db</a></p>
<h3 id="webhook">WebHook</h3>
<p>There is a WebHook to POST a <a href="#json-log-format">JSON Log Format</a> payload to <a href="https://github.com/SentryPeer/SentryPeer_HQ">SentryPeerHQ</a> or
your own WebHook endpoint.  The WebHook is <strong>not</strong> enabled by default. You can configure the WebHook URL via <code>-w</code> or set
the <code>SENTRYPEER_WEBHOOK_URL</code> env variable.</p>
<h3 id="restful-api">RESTful API</h3>
<p>The RESTful API is complete for the current use cases. Please click the Watch button to be notified when more things come out :-)</p>
<h4 id="endpoint-health-check">Endpoint /health-check</h4>
<p>Query the API to see if it&rsquo;s alive:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">curl -v -H <span class="s2">&#34;Content-Type: application/json&#34;</span> http://localhost:8082/health-check
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">* Connected to localhost <span class="o">(</span>127.0.0.1<span class="o">)</span> port <span class="m">8082</span> <span class="o">(</span><span class="c1">#0)</span>
</span></span><span class="line"><span class="cl">&gt; GET /health-check HTTP/1.1
</span></span><span class="line"><span class="cl">&gt; Host: localhost:8082
</span></span><span class="line"><span class="cl">&gt; User-Agent: curl/7.79.1
</span></span><span class="line"><span class="cl">&gt; Accept: */*
</span></span><span class="line"><span class="cl">&gt; Content-Type: application/json
</span></span><span class="line"><span class="cl">&gt; 
</span></span><span class="line"><span class="cl">* Mark bundle as not supporting multiuse
</span></span><span class="line"><span class="cl">&lt; HTTP/1.1 <span class="m">200</span> OK
</span></span><span class="line"><span class="cl">&lt; Date: Mon, <span class="m">24</span> Apr <span class="m">2022</span> 11:16:25 GMT
</span></span><span class="line"><span class="cl">&lt; Content-Type: application/json
</span></span><span class="line"><span class="cl">&lt; Access-Control-Allow-Origin: *
</span></span><span class="line"><span class="cl">&lt; X-Powered-By: SentryPeer
</span></span><span class="line"><span class="cl">&lt; X-SentryPeer-Version: 1.4.0
</span></span><span class="line"><span class="cl">&lt; Content-Length: <span class="m">81</span>
</span></span><span class="line"><span class="cl">&lt; 
</span></span><span class="line"><span class="cl"><span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="s2">&#34;status&#34;</span>: <span class="s2">&#34;OK&#34;</span>,
</span></span><span class="line"><span class="cl">  <span class="s2">&#34;message&#34;</span>: <span class="s2">&#34;Hello from SentryPeer!&#34;</span>,
</span></span><span class="line"><span class="cl">  <span class="s2">&#34;version&#34;</span>: <span class="s2">&#34;1.0.0&#34;</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><h4 id="endpoint-ip-addresses">Endpoint /ip-addresses</h4>
<p>List all the IP addresses that have been seen by SentryPeer:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">curl -v -H <span class="s2">&#34;Content-Type: application/json&#34;</span> http://localhost:8082/ip-addresses
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">* Connected to localhost <span class="o">(</span>127.0.0.1<span class="o">)</span> port <span class="m">8082</span> <span class="o">(</span><span class="c1">#0)</span>
</span></span><span class="line"><span class="cl">&gt; GET /ip-addresses HTTP/1.1
</span></span><span class="line"><span class="cl">&gt; Host: localhost:8082
</span></span><span class="line"><span class="cl">&gt; User-Agent: curl/7.79.1
</span></span><span class="line"><span class="cl">&gt; Accept: */*
</span></span><span class="line"><span class="cl">&gt; Content-Type: application/json
</span></span><span class="line"><span class="cl">&gt; 
</span></span><span class="line"><span class="cl">* Mark bundle as not supporting multiuse
</span></span><span class="line"><span class="cl">&lt; HTTP/1.1 <span class="m">200</span> OK
</span></span><span class="line"><span class="cl">&lt; Date: Mon, <span class="m">24</span> Jan <span class="m">2022</span> 11:17:05 GMT
</span></span><span class="line"><span class="cl">&lt; Content-Type: application/json
</span></span><span class="line"><span class="cl">&lt; Access-Control-Allow-Origin: *
</span></span><span class="line"><span class="cl">&lt; X-Powered-By: SentryPeer
</span></span><span class="line"><span class="cl">&lt; X-SentryPeer-Version: 1.0.0
</span></span><span class="line"><span class="cl">&lt; Content-Length: <span class="m">50175</span>
</span></span><span class="line"><span class="cl">&lt; 
</span></span><span class="line"><span class="cl"><span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="s2">&#34;ip_addresses_total&#34;</span>: 396,
</span></span><span class="line"><span class="cl">  <span class="s2">&#34;ip_addresses&#34;</span>: <span class="o">[</span>
</span></span><span class="line"><span class="cl">    <span class="o">{</span>
</span></span><span class="line"><span class="cl">      <span class="s2">&#34;ip_address&#34;</span>: <span class="s2">&#34;193.107.216.27&#34;</span>,
</span></span><span class="line"><span class="cl">      <span class="s2">&#34;seen_last&#34;</span>: <span class="s2">&#34;2022-01-11 13:30:48.703603359&#34;</span>,
</span></span><span class="line"><span class="cl">      <span class="s2">&#34;seen_count&#34;</span>:	<span class="s2">&#34;1263&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>,
</span></span><span class="line"><span class="cl">    <span class="o">{</span>
</span></span><span class="line"><span class="cl">      <span class="s2">&#34;ip_address&#34;</span>: <span class="s2">&#34;193.46.255.152&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="s2">&#34;seen_last&#34;</span>: <span class="s2">&#34;2022-01-11 13:28:27.348926406&#34;</span>,
</span></span><span class="line"><span class="cl">      <span class="s2">&#34;seen_count&#34;</span>: <span class="s2">&#34;3220&#34;</span>      
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">    ...
</span></span><span class="line"><span class="cl">  <span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><h4 id="endpoint-ip-addressip-address">Endpoint /ip-address/{ip-address}</h4>
<p>Query a single IP address:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">curl -v -H <span class="s2">&#34;Content-Type: application/json&#34;</span> http://localhost:8082/ip-address/8.8.8.8
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">* Connected to localhost <span class="o">(</span>127.0.0.1<span class="o">)</span> port <span class="m">8082</span> <span class="o">(</span><span class="c1">#0)</span>
</span></span><span class="line"><span class="cl">&gt; GET /ip-addresses/8.8.8.8 HTTP/1.1
</span></span><span class="line"><span class="cl">&gt; Host: localhost:8082
</span></span><span class="line"><span class="cl">&gt; User-Agent: curl/7.79.1
</span></span><span class="line"><span class="cl">&gt; Accept: */*
</span></span><span class="line"><span class="cl">&gt; Content-Type: application/json
</span></span><span class="line"><span class="cl">&gt; 
</span></span><span class="line"><span class="cl">* Mark bundle as not supporting multiuse
</span></span><span class="line"><span class="cl">&lt; HTTP/1.1 <span class="m">404</span> Not Found
</span></span><span class="line"><span class="cl">&lt; Date: Mon, <span class="m">24</span> Jan <span class="m">2022</span> 11:17:57 GMT
</span></span><span class="line"><span class="cl">&lt; Content-Type: application/json
</span></span><span class="line"><span class="cl">&lt; Access-Control-Allow-Origin: *
</span></span><span class="line"><span class="cl">&lt; X-Powered-By: SentryPeer
</span></span><span class="line"><span class="cl">&lt; X-SentryPeer-Version: 1.0.0
</span></span><span class="line"><span class="cl">&lt; Content-Length: <span class="m">33</span>
</span></span><span class="line"><span class="cl">&lt; 
</span></span><span class="line"><span class="cl">* Connection <span class="c1">#0 to host localhost left intact</span>
</span></span><span class="line"><span class="cl"><span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="s2">&#34;message&#34;</span>: <span class="s2">&#34;No bad actor found&#34;</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><h4 id="endpoint-numbersphone-number">Endpoint /numbers/{phone-number}</h4>
<p>Query a phone number a bad actor tried to call with optional <code>+</code> prefix:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">curl -v -H <span class="s2">&#34;Content-Type: application/json&#34;</span> http://localhost:8082/numbers/8784946812410967
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">* Connected to localhost <span class="o">(</span>127.0.0.1<span class="o">)</span> port <span class="m">8082</span> <span class="o">(</span><span class="c1">#0)</span>
</span></span><span class="line"><span class="cl">&gt; GET /numbers/8784946812410967 HTTP/1.1
</span></span><span class="line"><span class="cl">&gt; Host: localhost:8082
</span></span><span class="line"><span class="cl">&gt; User-Agent: curl/7.79.1
</span></span><span class="line"><span class="cl">&gt; Accept: */*
</span></span><span class="line"><span class="cl">&gt; Content-Type: application/json
</span></span><span class="line"><span class="cl">&gt; 
</span></span><span class="line"><span class="cl">* Mark bundle as not supporting multiuse
</span></span><span class="line"><span class="cl">&lt; HTTP/1.1 <span class="m">200</span> OK
</span></span><span class="line"><span class="cl">&lt; Date: Mon, <span class="m">24</span> Jan <span class="m">2022</span> 11:19:53 GMT
</span></span><span class="line"><span class="cl">&lt; Content-Type: application/json
</span></span><span class="line"><span class="cl">&lt; Access-Control-Allow-Origin: *
</span></span><span class="line"><span class="cl">&lt; X-Powered-By: SentryPeer
</span></span><span class="line"><span class="cl">&lt; X-SentryPeer-Version: 1.0.0
</span></span><span class="line"><span class="cl">&lt; Content-Length: <span class="m">46</span>
</span></span><span class="line"><span class="cl">&lt; 
</span></span><span class="line"><span class="cl"><span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="s2">&#34;phone_number_found&#34;</span>: <span class="s2">&#34;8784946812410967&#34;</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><h3 id="syslog-and-fail2ban">Syslog and Fail2ban</h3>
<p>With <code>sentrypeer -s</code>, you parse syslog and use Fail2Ban to block the IP address of the bad actor:</p>
<pre tabindex="0"><code class="language-syslog" data-lang="syslog">Nov 30 21:32:16 localhost.localdomain sentrypeer[303741]: Source IP: 144.21.55.36, Method: OPTIONS, Agent: sipsak 0.9.7
</code></pre><h3 id="json-log-format">JSON Log Format</h3>
<p>With <code>sentrypeer -j</code>, you can produce a JSON log file of the bad actor&rsquo;s IP address and the phone number they tried to call
plus other metadata (set a custom log file location with <code>-l</code>):</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&#34;app_name&#34;</span><span class="p">:</span><span class="s2">&#34;sentrypeer&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&#34;app_version&#34;</span><span class="p">:</span><span class="s2">&#34;v1.4.0&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&#34;event_timestamp&#34;</span><span class="p">:</span><span class="s2">&#34;2022-02-22 11:19:15.848934346&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&#34;event_uuid&#34;</span><span class="p">:</span><span class="s2">&#34;4503cc92-26cb-4b3e-bb33-69a83fa09321&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&#34;created_by_node_id&#34;</span><span class="p">:</span><span class="s2">&#34;4503cc92-26cb-4b3e-bb33-69a83fa09321&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&#34;collected_method&#34;</span><span class="p">:</span><span class="s2">&#34;responsive&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&#34;transport_type&#34;</span><span class="p">:</span><span class="s2">&#34;UDP&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&#34;source_ip&#34;</span><span class="p">:</span><span class="s2">&#34;45.134.144.128&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&#34;destination_ip&#34;</span><span class="p">:</span><span class="s2">&#34;XX.XX.XX.XX&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&#34;called_number&#34;</span><span class="p">:</span><span class="s2">&#34;0046812118532&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&#34;sip_method&#34;</span><span class="p">:</span><span class="s2">&#34;OPTIONS&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&#34;sip_user_agent&#34;</span><span class="p">:</span><span class="s2">&#34;friendly-scanner&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&#34;sip_message&#34;</span><span class="p">:</span><span class="s2">&#34;full SIP message&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h3 id="command-line-options">Command Line Options</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">./sentrypeer -h
</span></span><span class="line"><span class="cl">Usage: sentrypeer <span class="o">[</span>-h<span class="o">]</span> <span class="o">[</span>-V<span class="o">]</span> <span class="o">[</span>-w<span class="o">]</span> <span class="o">[</span>-j<span class="o">]</span> <span class="o">[</span>-p<span class="o">]</span> <span class="o">[</span>-b bootstrap.example.com<span class="o">]</span> <span class="o">[</span>-f fullpath <span class="k">for</span> sentrypeer.db<span class="o">]</span> <span class="o">[</span>-l fullpath <span class="k">for</span> sentrypeer_json.log<span class="o">]</span> <span class="o">[</span>-r<span class="o">]</span> <span class="o">[</span>-R<span class="o">]</span> <span class="o">[</span>-a<span class="o">]</span> <span class="o">[</span>-s<span class="o">]</span> <span class="o">[</span>-v<span class="o">]</span> <span class="o">[</span>-d<span class="o">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Options:
</span></span><span class="line"><span class="cl">  -h,      Print this <span class="nb">help</span>
</span></span><span class="line"><span class="cl">  -V,      Print version
</span></span><span class="line"><span class="cl">  -f,      Set <span class="s1">&#39;sentrypeer.db&#39;</span> location or use SENTRYPEER_DB_FILE env
</span></span><span class="line"><span class="cl">  -j,      Enable json logging or use SENTRYPEER_JSON_LOG env
</span></span><span class="line"><span class="cl">  -p,      Enable Peer to Peer mode or use SENTRYPEER_PEER_TO_PEER env
</span></span><span class="line"><span class="cl">  -b,      Set Peer to Peer bootstrap node or use SENTRYPEER_BOOTSTRAP_NODE env
</span></span><span class="line"><span class="cl">  -a,      Enable RESTful API mode or use SENTRYPEER_API env
</span></span><span class="line"><span class="cl">  -w,      Set WebHook URL <span class="k">for</span> bad actor json POSTs or use SENTRYPEER_WEBHOOK_URL env
</span></span><span class="line"><span class="cl">  -r,      Enable SIP responsive mode or use SENTRYPEER_SIP_RESPONSIVE env
</span></span><span class="line"><span class="cl">  -R,      Disable SIP mode completely or use SENTRYPEER_SIP_DISABLE env
</span></span><span class="line"><span class="cl">  -l,      Set <span class="s1">&#39;sentrypeer_json.log&#39;</span> location or use SENTRYPEER_JSON_LOG_FILE env
</span></span><span class="line"><span class="cl">  -s,      Enable syslog logging or use SENTRYPEER_SYSLOG env
</span></span><span class="line"><span class="cl">  -v,      Enable verbose logging or use SENTRYPEER_VERBOSE env
</span></span><span class="line"><span class="cl">  -d,      Enable debug mode or use SENTRYPEER_DEBUG env
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Report bugs to https://github.com/SentryPeer/SentryPeer/issues
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">See https://sentrypeer.org <span class="k">for</span> more information.
</span></span></code></pre></div><h3 id="ipv6-multicast-address">IPv6 Multicast Address</h3>
<p>The project has an IANA IPv6 multicast address for the purpose of sending messages between SentryPeer peers.</p>
<pre><code>Addresses: FF0X:0:0:0:0:0:0:172
Description: SentryPeer
Contact: Gavin Henry &lt;ghenry at sentrypeer.org&gt;
Registration Date: 2022-01-26
</code></pre>
<p>Please see <a href="http://www.iana.org/assignments/ipv6-multicast-addresses">http://www.iana.org/assignments/ipv6-multicast-addresses</a></p>
<p>The assigned variable-scope address &ndash; which can also be listed as &ldquo;FF0X::172&rdquo; for short &ndash; the &ldquo;X&rdquo; denotes any possible scope.</p>
<h3 id="license">License</h3>
<p>Great reading - <a href="https://www.gnu.org/licenses/license-recommendations.en.html">How to choose a license for your own work</a></p>
<p>This work is dual-licensed under GPL 2.0 and GPL 3.0.</p>
<p><code>SPDX-License-Identifier: GPL-2.0-only OR GPL-3.0-only</code></p>
<h3 id="contributing">Contributing</h3>
<p>See <a href="./CONTRIBUTING.md">CONTRIBUTING</a></p>
<h3 id="project-website">Project Website</h3>
<p><a href="https://sentrypeer.org">https://sentrypeer.org</a></p>
<h3 id="trademark">Trademark</h3>
<p><a href="https://trademarks.ipo.gov.uk/ipo-tmcase/page/Results/1/UK00003700947"><strong>SENTRYPEER</strong> is a registered trademark</a> of Gavin Henry</p>
<h3 id="questions-bug-reports-feature-requests">Questions, Bug reports, Feature Requests</h3>
<p>New issues can be raised at:</p>
<p><a href="https://github.com/SentryPeer/SentryPeer/issues">https://github.com/SentryPeer/SentryPeer/issues</a></p>
<p>It&rsquo;s okay to raise an issue to ask a question.</p>
<h3 id="special-thanks">Special Thanks</h3>
<p>Special thanks to:</p>
<ul>
<li><a href="https://github.com/psanders">psanders</a> from the <a href="https://github.com/fonoster/routr">Routr</a> project for <a href="https://mobile.twitter.com/pedrosanders_/status/1554572884714070019">tips on re-working this README.md</a> file.</li>
<li><a href="https://fly.io">Fly.io</a> for crediting the SentryPeer account for hosting the upcoming SentryPeer HQ web app on their infrastructure</li>
<li><a href="https://www.appsignal.com/">AppSignal</a> for Application performance monitoring sponsorship in the SentryPeer HQ web app</li>
<li><a href="http://davidmiller.io/">David Miller</a> for the design of the SentryPeer <a href="./web-gui-theme">Web GUI theme</a> and <a href="./web-gui-theme/src/assets/logo.svg">logo</a>. Very kind of you!</li>
<li><a href="https://github.com/garyemiller">@garymiller</a> for the feature request of syslog and Fail2ban as per <a href="https://github.com/SentryPeer/SentryPeer/issues/6"> Fail2ban Integration via syslog #6</a></li>
<li><a href="https://github.com/joejag">@joejag</a> for the <a href="https://github.com/SentryPeer/SentryPeer/pull/19">Pull Request</a> for the start of <a href="https://github.com/SentryPeer/SentryPeer/issues/12">Terraform recipes to launch SentryPeer on different cloud providers #12</a></li>
</ul>
]]></content:encoded>
    </item>
    
  </channel>
</rss>
